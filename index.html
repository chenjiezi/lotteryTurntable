<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>抽奖轮盘</title>
    <style>
      canvas {
        display: block;
        margin: 50px auto;
        border: 1px solid #ccc;
      }

      button {
        display: block;
        margin: 20px auto;
        padding: 10px 20px;
        font-size: 16px;
      }
    </style>
  </head>

  <body>
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
    <button id="spinButton">开始抽奖</button>

    <script>
      // 获取 Canvas 元素和绘图上下文
      const canvas = document.getElementById("wheelCanvas");
      const ctx = canvas.getContext("2d");
      const spinButton = document.getElementById("spinButton");

      // 定义轮盘的奖项
      const prizes = ["奖品1", "奖品2", "奖品3", "奖品4", "奖品5", "奖品6"];
      const numPrizes = prizes.length;
      /*
            2 * Math.PI 表示一个完成的圆的弧度
            numPrizes 表示扇形的数量
            angleStep 表示每个扇形的弧度
        */
      const angleStep = (2 * Math.PI) / numPrizes;

      // 绘制轮盘
      function drawWheel() {
        // 清除画布
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        // -20 是为了扇形到矩形边界留出一些间隙
        const radius = Math.min(centerX, centerY) - 20;

        for (let i = 0; i < numPrizes; i++) {
          const startAngle = i * angleStep;
          const endAngle = (i + 1) * angleStep;

          // 设置扇形颜色
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(centerX, centerY, radius, startAngle, endAngle);
          ctx.closePath();
          ctx.fillStyle = i % 2 === 0 ? "#FFB6C1" : "#FF69B4";
          ctx.fill();

          // 绘制文本 （扇形的中心点）
          const centroidFator = ((2 * Math.sin(angleStep)) / 3) * angleStep;
          const centroidAngle = startAngle + angleStep / 2;
          const textX = centerX + radius * centroidFator * Math.cos(centroidAngle);
          const textY = centerY + radius * centroidFator * Math.sin(centroidAngle);

          ctx.save();
          ctx.translate(textX, textY);
          ctx.rotate(centroidAngle + Math.PI / 2);
          ctx.fillStyle = "white";
          ctx.font = "20px Arial";
          ctx.textAlign = "center";
          ctx.fillText(prizes[i], 0, 0);
          ctx.restore();
        }

        // 绘制按钮
        ctx.save();
        ctx.beginPath();
        ctx.arc(centerX, centerY, 40, 0, 2 * Math.PI);
        ctx.fillStyle = "white";
        ctx.fill();
        ctx.strokeStyle = "black";
        ctx.lineWidth = 2;
        ctx.translate(centerX, centerY);
        ctx.fillStyle = "black";
        ctx.font = "16px Arial";
        ctx.textAlign = "center";
        ctx.fillText("开始抽奖", 0, 0);
        ctx.stroke();
        ctx.restore();
        

        // 绘制指针
        ctx.beginPath();
        ctx.moveTo(centerX, centerY - radius);
        ctx.lineTo(centerX, centerY - radius - 20);
        ctx.strokeStyle = "black";
        ctx.lineWidth = 2;
        ctx.stroke();
      }

      // 旋转动画
      let angle = 0;
      let isSpinning = false;
      let targetAngle = 0;

      function spin() {
        if (isSpinning) return;
        isSpinning = true;

        // 随机选择一个奖品
        const randomPrizeIndex = Math.floor(Math.random() * numPrizes);
        targetAngle =
          randomPrizeIndex * angleStep +
          Math.random() * angleStep +
          10 * 2 * Math.PI;

        const startTime = Date.now();

        function animate() {
          const currentTime = Date.now();
          const elapsedTime = currentTime - startTime;

          // if (angle < targetAngle) {
          if (elapsedTime < 3000) {
            // 减速效果
            const delta = Math.pow((targetAngle - angle) / targetAngle, 2) * 2;
            angle += delta;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate(angle);
            ctx.translate(-canvas.width / 2, -canvas.height / 2);
            drawWheel();
            ctx.restore();
            requestAnimationFrame(animate);
          } else {
            isSpinning = false;
            // 显示抽奖结果
            const finalPrizeIndex = Math.floor(
              (angle % (2 * Math.PI)) / angleStep
            );
            alert(`恭喜你，抽到了：${prizes[finalPrizeIndex]}`);
            angle = 0;
          }
        }

        animate();
      }

      // 初始化轮盘
      drawWheel();

      // 添加事件监听器
      spinButton.addEventListener("click", spin);
    </script>
  </body>
</html>
