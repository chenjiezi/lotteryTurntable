<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lucky Wheel</title>
    <style>
      #wheelCanvas {
        border: 1px solid #000;
      }
    </style>
  </head>

  <body>
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
    <button id="spinButton">开始抽奖</button>
    <script>
      // 获取 canvas 元素和绘图上下文
      const canvas = document.getElementById("wheelCanvas");
      const ctx = canvas.getContext("2d");
      const spinButton = document.getElementById("spinButton");

      // 定义轮盘的属性
      const radius = canvas.width / 2;
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const colors = [
        "#FFC300",
        "#DAF7A6",
        "#FF5733",
        "#C70039",
        "#900C3F",
        "#581845",
      ];
      const labels = [
        "奖品 1",
        "奖品 2",
        "奖品 3",
        "奖品 4",
        "奖品 5",
        "奖品 6",
      ];
      const numSegments = colors.length;
      let rotation = 0;
      let isSpinning = false;
      let startTime;

      // 绘制轮盘
      function drawWheel() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const segmentAngle = (2 * Math.PI) / numSegments;
        for (let i = 0; i < numSegments; i++) {
          const angleStart = i * segmentAngle + rotation;
          const angleEnd = (i + 1) * segmentAngle + rotation;

          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(centerX, centerY, radius, angleStart, angleEnd);
          ctx.closePath();
          ctx.fillStyle = colors[i];
          ctx.fill();

          // 绘制标签
          const labelAngle = angleStart + segmentAngle / 2;
          const labelX = centerX + radius * 0.7 * Math.cos(labelAngle);
          const labelY = centerY + radius * 0.7 * Math.sin(labelAngle);

          ctx.save();  
          ctx.translate(labelX,  labelY); 
          ctx.rotate(labelAngle  + Math.PI / 2); 

          ctx.fillStyle = "#000";
          ctx.font = "18px Arial";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(labels[i], 0, 0);

          ctx.restore();
        }
      }

      // 旋转动画
      function spin() {
        if (!isSpinning) return;

        const currentTime = Date.now();
        const elapsedTime = currentTime - startTime;

        if (elapsedTime < 3000) {
          // 前 3 秒加速旋转
          const speed = 0.02 + (elapsedTime / 3000) * 0.05;
          rotation += speed;
        } else {
          // 3 秒后逐渐减速
        //   const deceleration = 0.0001;
        //   if (rotation > 0) {
        //     console.log("rotation:", rotation);
        //     rotation -= deceleration;
        //   } else {
            rotation = 0;
            isSpinning = false;
            const winningSegment = Math.floor(
              (rotation % (2 * Math.PI)) / ((2 * Math.PI) / numSegments)
            );
            alert(`恭喜你，获得了 ${labels[winningSegment]}！`);
        //   }
        }

        drawWheel();
        requestAnimationFrame(spin);
      }

      // 按钮点击事件
      spinButton.addEventListener("click", () => {
        if (!isSpinning) {
          isSpinning = true;
          startTime = Date.now();
          rotation = 0;
          spin();
        }
      });

      // 初始绘制轮盘
      drawWheel();
    </script>
  </body>
</html>
